# 웹 서치 실패 시 명확한 메시지 표시 가이드

## 🎯 목표

웹 서치 실패 시 사용자에게 **명확하게 정보가 없다고 알려주기**

---

## ✅ 개선 내용

### 1. **뉴스 수집 단계 메시지**

#### Before (이전)
```
Tavily를 사용한 최근 전기차 뉴스 수집 중...
[OK] 총 0개 뉴스 기사 수집 완료
```

#### After (개선)
```
========================================
[웹 서치를 통한 뉴스 수집 시작]
========================================
Tavily를 사용한 최근 전기차 뉴스 수집 중...

[1/20] 'electric vehicle news today' 웹 검색 중...
[경고] 'electric vehicle news today': 검색 결과가 없습니다 (웹 서치 실패 또는 정보 없음)
→ 해당 검색어에 대한 정보를 가져올 수 없습니다.

========================================
⚠️  [경고] 뉴스 데이터를 수집하지 못했습니다!
→ 웹 서치가 실패했거나 검색 결과가 없습니다.
→ 기본 기업 리스트를 사용하여 공시 데이터를 수집합니다.
========================================
```

---

### 2. **공시 수집 단계 메시지**

#### 뉴스가 없을 때
```
⚠️  [경고] 뉴스 기사가 없습니다!
→ 웹 서치 실패로 인해 뉴스에서 기업을 추출할 수 없습니다.
→ 대신 기본 기업 리스트를 사용하여 공시를 수집합니다.
```

#### 기업을 찾지 못했을 때
```
⚠️  [경고] 뉴스에서 EV 관련 기업을 찾지 못했습니다!
→ 뉴스 내용에 EV 기업명이 포함되지 않았습니다.
→ 대신 기본 기업 리스트를 사용합니다.
```

#### 공시 데이터 전략 표시
```
========================================
[공시 데이터 수집 전략]
========================================
📋 데이터 소스: 기본 기업 리스트 (뉴스 데이터 없음)
- 한국 기업 (DART): 5개
- 미국 기업 (SEC): 3개
- 그 외 기업 (Yahoo Finance): 4개
- Relaxed Mode: 활성화
========================================
```

---

### 3. **데이터 소스별 실패 메시지**

#### DART 공시 실패
```
========================================
[한국 기업 공시 수집 - DART]
========================================
...
⚠️  [경고] DART 공시 데이터를 찾지 못했습니다!
→ 해당 기업의 공시가 기간 내에 없거나 API 호출이 실패했습니다.
→ 한국 기업 공시 정보 없이 분석을 계속합니다.
========================================
```

#### SEC 공시 실패
```
========================================
[미국 기업 공시 수집 - SEC EDGAR]
========================================
...
⚠️  [경고] SEC 공시 데이터를 찾지 못했습니다!
→ 해당 기업의 SEC 공시가 없거나 API 호출이 실패했습니다.
→ 미국 기업 공시 정보 없이 분석을 계속합니다.
========================================
```

---

### 4. **최종 수집 결과 요약**

#### 공시/재무 데이터 요약
```
========================================
[공시/재무 데이터 수집 결과 요약]
========================================
❌ [실패] 공시/재무 데이터를 수집하지 못했습니다!
→ 모든 데이터 소스(DART/SEC/Yahoo)에서 정보를 가져올 수 없었습니다.
→ 뉴스 데이터만으로 분석을 진행하거나, API 설정을 확인하세요.
========================================
```

#### MarketTrendAgent 최종 요약
```
============================
[MarketTrendAgent] 데이터 수집 완료
============================
📰 뉴스 기사: 0개
📋 공시/재무 데이터: 0개

⚠️  경고: 뉴스 데이터가 없습니다!
   → 웹 서치가 실패했거나 검색 결과가 없습니다.

⚠️  경고: 공시/재무 데이터가 없습니다!
   → 모든 데이터 소스에서 정보를 가져올 수 없었습니다.

❌ 중요: 모든 데이터 소스에서 정보 수집 실패!
   → 인터넷 연결, API 키, API 사용량 한도를 확인하세요.
============================
```

---

## 📊 메시지 레벨

### ✅ 성공 메시지
- **아이콘**: `✅`
- **예시**: `✅ [성공] 총 50개 뉴스 기사 수집 완료`

### ⚠️ 경고 메시지
- **아이콘**: `⚠️`
- **예시**: `⚠️ [경고] 뉴스 데이터를 수집하지 못했습니다!`
- **설명**: 일부 데이터가 없지만 시스템은 계속 진행

### ❌ 에러 메시지
- **아이콘**: `❌`
- **예시**: `❌ [실패] 공시/재무 데이터를 수집하지 못했습니다!`
- **설명**: 모든 데이터 수집 실패, 심각한 문제

### 📋 정보 메시지
- **아이콘**: `📋`, `📰`
- **예시**: `📋 데이터 소스: 기본 기업 리스트 (뉴스 데이터 없음)`
- **설명**: 상태 정보 표시

---

## 🎯 사용자 액션 가이드

각 메시지에 **구체적인 해결 방법** 제시:

### 뉴스 데이터 없음
```
→ 웹 서치가 실패했거나 검색 결과가 없습니다.
→ 기본 기업 리스트를 사용하여 공시 데이터를 수집합니다.
```
**의미**: Tavily API 실패 또는 크레딧 부족

### 공시 데이터 없음
```
→ 모든 데이터 소스(DART/SEC/Yahoo)에서 정보를 가져올 수 없었습니다.
→ 뉴스 데이터만으로 분석을 진행하거나, API 설정을 확인하세요.
```
**의미**: DART/SEC API 키 문제 또는 네트워크 문제

### 모든 데이터 없음
```
→ 인터넷 연결, API 키, API 사용량 한도를 확인하세요.
```
**체크리스트**:
1. ✅ 인터넷 연결 확인
2. ✅ `.env` 파일에 API 키 설정 확인
3. ✅ Tavily API 크레딧 잔액 확인
4. ✅ DART API 키 유효성 확인

---

## 💡 실행 예시

### 정상 케이스 (모든 데이터 수집 성공)
```
========================================
[웹 서치를 통한 뉴스 수집 시작]
========================================
Tavily를 사용한 최근 전기차 뉴스 수집 중...
[1/20] 'electric vehicle news today' 웹 검색 중...
[OK] 5개 기사 수집 (총 5개)
...
========================================
✅ [성공] 총 50개 뉴스 기사 수집 완료 (최근 30일 이내)
========================================

========================================
[공시 데이터 수집 전략]
========================================
📰 데이터 소스: 뉴스 기사에서 추출
- 한국 기업 (DART): 8개
- 미국 기업 (SEC): 5개
- 그 외 기업 (Yahoo Finance): 6개
========================================

========================================
[공시/재무 데이터 수집 결과 요약]
========================================
✅ [성공] 총 65개 공시/재무 데이터 수집 완료
========================================

============================
[MarketTrendAgent] 데이터 수집 완료
============================
📰 뉴스 기사: 50개
📋 공시/재무 데이터: 65개
============================
```

### 부분 실패 케이스 (뉴스만 수집 성공)
```
========================================
✅ [성공] 총 50개 뉴스 기사 수집 완료 (최근 30일 이내)
========================================

========================================
[공시 데이터 수집 전략]
========================================
📰 데이터 소스: 뉴스 기사에서 추출
- 한국 기업 (DART): 5개
- 미국 기업 (SEC): 3개
========================================

========================================
[한국 기업 공시 수집 - DART]
========================================
⚠️  [경고] DART 공시 데이터를 찾지 못했습니다!
→ 해당 기업의 공시가 기간 내에 없거나 API 호출이 실패했습니다.
========================================

========================================
[공시/재무 데이터 수집 결과 요약]
========================================
⚠️  [주의] 공시/재무 데이터가 부족합니다: 3개
→ 일부 데이터 소스에서만 정보를 수집했을 수 있습니다.
========================================

============================
[MarketTrendAgent] 데이터 수집 완료
============================
📰 뉴스 기사: 50개
📋 공시/재무 데이터: 3개

⚠️  경고: 공시/재무 데이터가 없습니다!
   → 모든 데이터 소스에서 정보를 가져올 수 없었습니다.
============================
```

### 완전 실패 케이스 (모든 데이터 수집 실패)
```
========================================
[웹 서치를 통한 뉴스 수집 시작]
========================================
[1/20] 'electric vehicle news today' 웹 검색 중...
[경고] 'electric vehicle news today': 검색 결과가 없습니다
→ 해당 검색어에 대한 정보를 가져올 수 없습니다.
...
========================================
⚠️  [경고] 뉴스 데이터를 수집하지 못했습니다!
→ 웹 서치가 실패했거나 검색 결과가 없습니다.
→ 기본 기업 리스트를 사용하여 공시 데이터를 수집합니다.
========================================

========================================
[공시 데이터 수집 전략]
========================================
📋 데이터 소스: 기본 기업 리스트 (뉴스 데이터 없음)
- 한국 기업 (DART): 5개
- 미국 기업 (SEC): 3개
========================================

⚠️  [경고] DART 공시 데이터를 찾지 못했습니다!
⚠️  [경고] SEC 공시 데이터를 찾지 못했습니다!

========================================
[공시/재무 데이터 수집 결과 요약]
========================================
❌ [실패] 공시/재무 데이터를 수집하지 못했습니다!
→ 모든 데이터 소스(DART/SEC/Yahoo)에서 정보를 가져올 수 없었습니다.
→ 뉴스 데이터만으로 분석을 진행하거나, API 설정을 확인하세요.
========================================

============================
[MarketTrendAgent] 데이터 수집 완료
============================
📰 뉴스 기사: 0개
📋 공시/재무 데이터: 0개

⚠️  경고: 뉴스 데이터가 없습니다!
   → 웹 서치가 실패했거나 검색 결과가 없습니다.

⚠️  경고: 공시/재무 데이터가 없습니다!
   → 모든 데이터 소스에서 정보를 가져올 수 없었습니다.

❌ 중요: 모든 데이터 소스에서 정보 수집 실패!
   → 인터넷 연결, API 키, API 사용량 한도를 확인하세요.
============================
```

---

## 🔧 코드 변경 사항

### `agents/market_trend_agent.py`

**주요 변경:**
1. 웹 서치 시작/종료 시 박스형 메시지 (`========================================`)
2. 검색 실패 시 명확한 경고 메시지
3. 데이터가 없을 때 `⚠️`, `❌` 아이콘으로 시각적 표시
4. 각 단계별 결과 요약 (성공/주의/실패 구분)
5. 최종 요약에서 전체 상황 파악 가능

---

## 🎯 개선 효과

### Before (이전)
- ❌ 조용히 실패 (사용자가 눈치채기 어려움)
- ❌ 에러 메시지가 로그에 묻힘
- ❌ 무엇이 문제인지 파악 어려움

### After (개선)
- ✅ **명확한 경고 메시지** (⚠️, ❌ 아이콘)
- ✅ **구체적인 원인 설명** (웹 서치 실패, API 호출 실패 등)
- ✅ **해결 방법 제시** (API 키 확인, 인터넷 연결 등)
- ✅ **시각적 구분** (박스, 아이콘, 들여쓰기)
- ✅ **진행 상황 추적** (각 단계별 성공/실패 표시)

---

## 📝 추가 개선 계획

1. **로그 파일 저장**
   - 모든 경고/에러 메시지를 파일로 저장
   - 사후 분석 가능

2. **Slack/이메일 알림**
   - 중요한 실패 시 알림 발송
   - 실시간 모니터링

3. **자동 재시도**
   - 웹 서치 실패 시 자동 재시도
   - Exponential backoff 적용

4. **대시보드**
   - 데이터 수집 현황 시각화
   - 성공률, 실패율 추적

---

**마지막 업데이트:** 2025-10-24  
**버전:** 2.1.0

